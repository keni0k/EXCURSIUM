<!DOCTYPE HTML>
<!--
  Copyright 2015 Benedikt Ritter

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title th:text="${#messages.msg('titles.persons')}">Модерация контента</title>
    <meta name="description" content=""/>
    <meta name="title" content=""/>
    <meta name="author" content=""/>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
    <meta name="keywords" content="excursium"/>

    <link rel="stylesheet" type="text/css" href="../resources/css/styles.css"/>
    <link rel="stylesheet" href="../resources/css/media.css"/>
    <link rel="stylesheet" type="text/css" href="../resources/css/footer.css"/>
    <link rel="stylesheet" href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css"/>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css"/>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

    <!-- Icon -->
    <link rel="icon" href="../resources/img/icon.ico" type="image/x-icon"/>
    <link rel="shortcut icon" href="../resources/img/icon.ico" type="image/x-icon"/>

    <link rel="stylesheet" href="../resources/libs/bootstrap-select/css/bootstrap-select.css"/>
    <script type="text/javascript" src="../resources/libs/bootstrap-select/js/bootstrap-select.js"></script>

    <link rel="stylesheet" href="../resources/css/segoe_ui.css"/>

    <link rel="stylesheet" href="../resources/libs/bootstrapformhelpers/css/bootstrap-formhelpers.min.css"/>
    <script type="text/javascript"
            src="../resources/libs/bootstrapformhelpers/js/bootstrap-formhelpers.min.js"></script>
</head>
<body style="background-color: #f9f9f9;">
<style type="text/css">

    .navbar-fixed-top {
        min-height: 95px;
    }

    .navbar-nav > li > a {
        font-family: SegoeUIRegular, serif;
        padding-top: 0;
        padding-bottom: 0;
        line-height: 95px;
    }

    .navbar-custom {
        background: linear-gradient(to left, #68b3bd, #00ae6f);
        color: #000000;
        border-radius: 0;
    }

    .navbar-custom .navbar-nav > li > a {
        color: #000000;
    }

    .navbar-custom .navbar-nav > .active > a {
        color: #000000;
        background-color: transparent;
    }

    .navbar-custom .navbar-nav > li > a:hover,
    .navbar-custom .navbar-nav > li > a:focus,
    .navbar-custom .navbar-nav > .active > a:hover,
    .navbar-custom .navbar-nav > .active > a:focus,
    .navbar-custom .navbar-nav > .open > a {
        text-decoration: none;
        background-color: #B2EBF2;
    }

    .navbar-custom .navbar-brand {
        color: #eeeeee;
    }

    .navbar-custom .navbar-toggle {
        background-color: #eeeeee;
    }

    .navbar-custom .icon-bar {
        background-color: #33aa33;
    }
</style>
<div class="content"
     th:with="isUser = ${#httpServletRequest.isUserInRole('USER')}, isAdmin = ${#httpServletRequest.isUserInRole('ADMIN')},
              id = ${#httpServletRequest.getParameter('id')}, sortBy = ${#httpServletRequest.getParameter('sort_by')},
              type = ${#httpServletRequest.getParameter('type')}, rateDown = ${#httpServletRequest.getParameter('rate_down')},
              rateUp = ${#httpServletRequest.getParameter('rate_up')}, firstName = ${#httpServletRequest.getParameter('first_name')},
              lastName = ${#httpServletRequest.getParameter('last_name')}, city = ${#httpServletRequest.getParameter('city')}">
    <nav class="navbar navbar-default navbar-custom" role="navigation">
        <div class="container-fluid">
            <!-- Brand and toggle get grouped for better mobile display -->
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse"
                        data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle Navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>

                <a class="navbar-brand" href="/">
                    <img id="brand-image" alt="Website Logo" src="../resources/img/logo.png"/>
                </a>
            </div>

            <!-- Collect the nav links, forms, and other content for toggling -->
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">

                <!-- Содержимое основной части -->
                <ul class="nav navbar-nav navbar-right">
                    <li><a href="/events/list" th:text="${#messages.msg('titles.excursions')}">Экскурсии</a></li>
                    <li><a href="#">FAQ</a></li>
                    <li><a href="/index#contact" th:text="${#messages.msg('titles.contacts')}">Контакты</a></li>
                    <li th:if="${isAdmin}"><a href="/users/moderation" th:text="${#messages.msg('titles.persons')}">Модерация
                        пользователей</a></li>
                    <li th:if="${isAdmin}"><a href="/events/moderation" th:text="${#messages.msg('titles.events')}">Модерация
                        экскурсий</a></li>
                    <li th:unless="${isUser}"><a href="/users/registration"
                                                 th:text="${#messages.msg('titles.registration')}">Регистрация</a></li>
                    <li th:unless="${isUser}"><a href="/users/login"
                                                 th:text="${#messages.msg('titles.login')}">Войти</a></li>
                    <li th:if="${isUser} or ${isAdmin}"><a href="/users/logout"
                                                           th:text="${#messages.msg('titles.logout')}">Выйти</a></li>
                </ul>

            </div><!-- navbar collapse end -->
        </div><!-- container-fluid end -->
    </nav>
    <div class="container">
        <div class="page-header">
            <h1 th:text="${#messages.msg('titles.persons')}">Модерация пользователей</h1>
        </div>
        <div class="row">
            <div class="col-md-12 col-lg-6">

                <th:block th:if="${message != null}">
                    <div th:replace="fragments/alert :: alert (type=${#strings.toLowerCase(message.type)}, message=${message.message})">
                        &nbsp;
                    </div>
                </th:block>

                <form th:object="${insertPerson}" action="/users/moderation" method="POST">

                    <div class="panel panel-default">
                        <div class="panel-heading" th:text="${#messages.msg('words.type')}">
                            Тип пользователя
                        </div>
                        <div class="panel-body">
                            <div class="input-group">
                                <select name="type" class="form-control selectpicker"
                                        th:selected="${insertPerson.getType()}?${insertPerson.getType()}:0">
                                    <option value="-3" th:text="${#messages.msg('user.type.unconfirmed')}">Не
                                        активирован
                                    </option>
                                    <option value="-2" th:text="${#messages.msg('user.type.blocked')}">Заблокированный
                                    </option>
                                    <option value="1" th:text="${#messages.msg('user.type.tourist')}">Турист</option>
                                    <option value="2" th:text="${#messages.msg('user.type.guide')}">Экскурсовод</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.login')}">Логин</span>
                        <input name="login" id="login" type="text" pattern="[a-zA-Z0-9._\-]{4,20}" class="form-control"
                               placeholder="Логин" disabled="disabled" aria-label="Логин"
                               th:value="${insertPerson.getLogin()}" required=""/>
                        <label for="login" th:if="${error_login}" th:text="${#messages.msg('error.user.login.free')}"
                               th:class="'error'">Name Error</label>
                        <label for="login" th:if="${#fields.hasErrors('login')}"
                               th:text="${#messages.msg('error.user.login.size')}" th:class="'error'">Name Error</label>
                    </div>
                    <br/>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.first_name')}">Имя</span>
                        <input name="firstName" type="text" class="form-control"
                               th:value="${insertPerson.getFirstName()}" placeholder="Имя" aria-label="Имя"
                               required=""/>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.last_name')}">Фамилия</span>
                        <input name="lastName" type="text" class="form-control" th:value="${insertPerson.getLastName()}"
                               placeholder="Фамилия" required=""
                               aria-label="Фамилия"/>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.photo')}">Фотография</span>
                        <input name="file" type="file" id="file" class="form-control" placeholder="Фотография"
                               required=""
                               accept="image/jpeg,image/png" aria-label="Фотография"/>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon">Email</span>
                        <input name="email" id="email" type="email" class="form-control" disabled="disabled"
                               th:value="${insertPerson.getEmail()}" placeholder="Email" aria-label="Email"
                               required=""/>
                        <label for="email" th:if="${error_email_free}"
                               th:text="${#messages.msg('error.user.email.free')}" th:class="'error'">Name Error</label>
                        <label for="email" th:if="${error_email_valid}"
                               th:text="${#messages.msg('error.user.email.valid')}" th:class="'error'">Name
                            Error</label>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.phone')}">Телефон</span>
                        <input name="phoneNumber" type="text" class="form-control bfh-phone"
                               th:value="${insertPerson.getPhoneNumber()}" placeholder="Телефон" required=""
                               minlength="17" disabled="disabled"
                               aria-label="Телефон" data-format="+7 (ddd) ddd-dddd" id="phone_number"/>
                        <label for="phone_number" th:if="${error_phone}"
                               th:text="${#messages.msg('error.user.phone_number.free')}" th:class="'error'">Name
                            Error</label>
                        <label for="phone_number" th:if="${#fields.hasErrors('phoneNumber')}"
                               th:text="${#messages.msg('error.user.phone_number.invalid')}" th:class="'error'">Name
                            Error</label>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.about_me')}">О себе</span>
                        <textarea name="about" class="form-control" placeholder="О себе" aria-label="О себе" required=""
                                  th:text="${insertPerson.getAbout()}"></textarea>
                    </div>
                    <br/>
                    <div class="input-group">
                        <span class="input-group-addon" th:text="${#messages.msg('words.city')}">Город</span>
                        <input name="city" type="text" class="form-control" th:value="${insertPerson.getCity()}"
                               placeholder="Город" required="" aria-label="Город"/>
                    </div>
                    <br/>
                    <button type="reset" class="btn btn-default" th:text="${#messages.msg('words.reset')}">Сброс
                    </button>
                    <button type="submit" class="btn btn-default" th:text="${#messages.msg('words.submit')}">Сохранить
                    </button>

                </form>
            </div>
        </div>

        <hr/>

        <div class="row">
            <div class="col-sm-12">
                <table class="table table-striped">
                    <thead>
                    <tr>
                        <th>Users</th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr>
                        <td th:href="@{/users/moderation(sort_by=${inc},id=${id},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}">ID</td>
                        <td th:text="${#messages.msg('words.login')}">Логин</td>
                        <td th:text="${#messages.msg('words.first_name')}"
                            th:href="@{/users/moderation(sort_by=${inc}+6,id=${id},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}">Имя</td>
                        <td th:text="${#messages.msg('words.last_name')}"
                            th:href="@{/users/moderation(sort_by=${inc}+8,id=${id},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}">Фамилия</td>
                        <td th:text="${#messages.msg('words.city')}"
                            th:href="@{/users/moderation(sort_by=${inc}+10,id=${id},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}">Город</td>
                        <td>Email</td>
                        <td th:text="${#messages.msg('words.phone')}">Телефон</td>
                        <td th:text="${#messages.msg('words.type')}"
                            th:href="@{/users/moderation(sort_by=${inc}+4,id=${id},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}">Тип</td>
                        <td th:text="${#messages.msg('words.rate')}"
                            th:href="@{/users/moderation(sort_by=${inc}+2,id=${id},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}">Рейтинг</td>
                        <td th:text="${#messages.msg('words.token')}">Токен</td>
                        <td th:text="${#messages.msg('words.change')}">Изменить</td>
                        <td th:text="${#messages.msg('words.delete')}">Удалить</td>
                    </tr>
                    <tr th:each="person : ${persons}">
                        <td th:text="${person.id}">Some text</td>
                        <td th:text="${person.login}">Some text</td>
                        <td th:text="${person.firstName}">Some text</td>
                        <td th:text="${person.lastName}">Some text</td>
                        <td th:text="${person.city}">Some text</td>
                        <td th:text="${person.email}">Some text</td>
                        <td th:text="${person.phoneNumber}">Some text</td>
                        <td th:text="${person.type}">Some text</td>
                        <td th:text="${person.rate}">Some text</td>
                        <td th:text="${person.token}">Some text</td>
                        <td><a th:href="@{/users/moderation(id = ${person.id},sort_by=${sortBy},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}"><img
                                src="../resources/img/icons/edit.png"/></a></td>
                        <td><a th:href="@{/users/delete(id = ${person.id},sort_by=${sortBy},type=${type},rate_down=${rateDown},rate_up=${rateUp}, first_name=${firstName}, last_name=${lastName}, city=${city})}"><img
                                src="../resources/img/icons/del.png"/></a></td>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<footer id="myFooter">
    <div class="container">
        <h7 class="logo"><a href="#">&copy; 2017 Excursium</a></h7>
        <div class="social-icons">
            <a href="https://vk.com/excursium" class="twitter"><i class="fa fa-vk"></i></a>
        </div>
    </div>
</footer>
</body>
</html>